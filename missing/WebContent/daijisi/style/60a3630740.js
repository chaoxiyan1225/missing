!function($){"use strict";var escape=/["\\\x00-\x1f\x7f-\x9f]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},hasOwn=Object.prototype.hasOwnProperty;$.toJSON="object"==typeof JSON&&JSON.stringify?JSON.stringify:function(a){if(null===a)return"null";var b,c,d,e,f=$.type(a);if("undefined"===f)return void 0;if("number"===f||"boolean"===f)return String(a);if("string"===f)return $.quoteString(a);if("function"==typeof a.toJSON)return $.toJSON(a.toJSON());if("date"===f){var g=a.getUTCMonth()+1,h=a.getUTCDate(),i=a.getUTCFullYear(),j=a.getUTCHours(),k=a.getUTCMinutes(),l=a.getUTCSeconds(),m=a.getUTCMilliseconds();return 10>g&&(g="0"+g),10>h&&(h="0"+h),10>j&&(j="0"+j),10>k&&(k="0"+k),10>l&&(l="0"+l),100>m&&(m="0"+m),10>m&&(m="0"+m),'"'+i+"-"+g+"-"+h+"T"+j+":"+k+":"+l+"."+m+'Z"'}if(b=[],$.isArray(a)){for(c=0;c<a.length;c++)b.push($.toJSON(a[c])||"null");return"["+b.join(",")+"]"}if("object"==typeof a){for(c in a)if(hasOwn.call(a,c)){if(f=typeof c,"number"===f)d='"'+c+'"';else{if("string"!==f)continue;d=$.quoteString(c)}f=typeof a[c],"function"!==f&&"undefined"!==f&&(e=$.toJSON(a[c]),b.push(d+":"+e))}return"{"+b.join(",")+"}"}},$.evalJSON="object"==typeof JSON&&JSON.parse?JSON.parse:function(str){return eval("("+str+")")},$.secureEvalJSON="object"==typeof JSON&&JSON.parse?JSON.parse:function(str){var filtered=str.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered))return eval("("+str+")");throw new SyntaxError("Error parsing JSON, source is not valid.")},$.quoteString=function(a){return a.match(escape)?'"'+a.replace(escape,function(a){var b=meta[a];return"string"==typeof b?b:(b=a.charCodeAt(),"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16))})+'"':'"'+a+'"'}}(jQuery);var pageCheckoutEffect=function(a){var b=$('[data-orderfrom="true"]'),c=$('[data-OrderFailFrom="true"]'),d=$('[data-cartforms="address"]'),e=$('[data-cartforms="time"]'),f=$('[data-cartforms="payway"]'),g=$('[data-paytype="bank"]'),h=$('[data-paytype="list"]'),i=$('[data-cartforms="invoice"]'),j=$('[data-addaddress="true"]'),k=$('[data-cartforms="idcard"]'),l=d.children(".title"),m=k.find("li:eq(0)"),n=$('[data-paytypetip="true"]'),o={hasSpace:function(a){var b=/[\s]/g;return-1==a.search(b)?!1:!0},textValid:function(a){var b=new RegExp("[`~!@#$^%*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）—|{}【】‘；：”“'。，、？]","g");return b.test(a)},rightCity:function(a){var b=new Array,c={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};return a=a.replace(/x$/i,"a"),null==c[parseInt(a.substr(0,2))]?(b[0]=!1,b[1]="身份证格式有误",b):(b[0]=!0,b[1]="",b)},is15IdCard:function(a){var b=new Array,c=a.substring(6,8),d=a.substring(8,10),e=a.substring(10,12),f=new Date(c,parseFloat(d)-1,parseFloat(e));return f.getYear()!=parseFloat(c)||f.getMonth()!=parseFloat(d)-1||f.getDate()!=parseFloat(e)?(b[0]=!1,b[1]="身份证格式有误!",b):(b[0]=!0,b[1]="",b)},is18IdCard:function(a){var b=new Array,c=a.substring(6,10),d=a.substring(10,12),e=a.substring(12,14),f=new Date(c,parseFloat(d)-1,parseFloat(e));return f.getFullYear()!=parseFloat(c)||f.getMonth()!=parseFloat(d)-1||f.getDate()!=parseFloat(e)?(b[0]=!1,b[1]="身份证格式有误",b):(b[0]=!0,b[1]="",b)},isTrueCodeBy18IdCard:function(a){var b=0,c=new Array,d=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1],e=[1,0,10,9,8,7,6,5,4,3,2];"x"==a[17].toLowerCase()&&(a[17]=10);for(var f=0;17>f;f++)b+=d[f]*a[f];return valCodePosition=b%11,a[17]==e[valCodePosition]?(c[0]=!0,c[1]="",c):(c[0]=!1,c[1]="身份证格式有误",c)},idCardValidate:function(a){var a=$.trim(a.val().replace(/ /g,"")),b=o.rightCity(a);if(b[0]){if(15==a.length){var c=o.is15IdCard(a);return c[0]?!0:(o.noty(m,c[1],100),!1)}if(18==a.length){var d=a.split(""),e=o.is18IdCard(a),f=o.isTrueCodeBy18IdCard(d);return e[0]&&f[0]?!0:(e[0]?!f[0]&&o.noty(m,f[1],100):o.noty(m,e[1],100),!1)}return o.noty(m,"请输入15或18位身份证号码！",100),!1}return o.noty(m,b[1],100),!1},noty:function(b,c,d){a.blackDialog(c,null,3e3),a.flicker(b,"ui-note-error",!1,1,5,d)}},p={removeTxt:function(){var a=$(this),b=a.parent().children(".controls:eq(0)").children("input");b.val()&&""!=b.val()&&b.val("")},keyUp:function(){var a=$(this).val();""!=$.trim(a)?setTimeout(function(){$(this).parents(that.UI.formGroup).addClass("z-id-num-typing"),$(that.UI.idNumFloat).text(a)},10):(verifySubmit.addClass("z-btn-disabled"),$(this.UI.idInput).parents(this.UI.formItem).removeClass("z-id-num-typing"))}},q={runTime:function(){var b=$('[data-countTime="true"]'),c={elem:b,container:".count-time",startTime:parseInt(b.attr("data-cartTime")),timeStamp:{day:"",hour:"",min:":",sec:""},halfwayTime:!1,action:"remain",callback:!0,callbackFunction:function(){this.html("00:00"),self.location.href="cart.html"}};!isNaN(c.startTime)&&c.startTime>0&&a.countDown(c)}},r={detect:function(){return this.is(":hidden")}},s={init:function(){var a=$(this),b={elem:a,next:a.next(),toggle:a.parent().data("toggle"),collapse:a.parent().data("collapse"),child:a.children().filter('[class^="i-icon-arrow"]'),remove:!0,scrol:!1};b.collapse&&s.slide.toggle.call(b)},slide:{toggle:function(){this.next.length&&r.detect.call(this.next)?(this.child.addClass(this.toggle),this.next.slideDown(),this.scrol&&s.slide.scrol.call(this.elem)):(this.remove&&this.child.removeClass(this.toggle),this.next.slideUp())},up:function(){this.next.length&&!r.detect.call(this.next)&&(this.child.removeClass(this.toggle),this.next.slideUp())},down:function(){this.elemLink.length&&r.detect.call(this.elemLink)&&this.elemLink.slideDown()},scrol:function(){$("body,html").animate({scrollTop:this.offset().top},200)}},tab:function(){var a=this.next,b=this.index;this.elem.addClass("active").siblings().removeClass("active"),a.filter(":visible").fadeOut("fast",function(){a.eq(b).fadeIn("fast")})},noty:{address:function(b,c){var d={elem:b,elemLink:b.children("ul.nav")};a.redDialog(c),a.flicker(d.elem,"ui-note-error",!0,0,5,44),d.elemLink.length&&s.slide.down.call(d)},addressTip:function(b,c,d){var e={elem:b,elemLink:b.children("ul.nav")};d&&d.html(c).show(),a.flicker(e.elem,"ui-note-error",!0,0,2,44,500),e.elemLink.length&&s.slide.down.call(e)}}},t={info:{init:function(){var a=$(this),b={elem:a,radio:a.children().filter(".i-radio"),input:a.children().filter('input[type="radio"]'),addressId:a.children('input[name="address_id"]'),neighbor:a.siblings("li"),collapse:a.parent().parent().data("collapse"),text:a.children("p:eq(0)").html(),address:a.children("p:eq(1)").length?a.children("p:eq(1)").html():null,unTitle:a.parent().prev().children('[data-unable="title"]'),unMsg:a.children('[data-unable="msg"]'),remove:!0};!b.radio.hasClass("active")&&!(1==b.input.attr("checked"))&&b.radio.addClass("active").parent().children().filter('input[type="radio"]').attr("checked",!0),b.neighbor.children().filter(".i-radio").removeClass("active").parent().children().filter('input[type="radio"]').attr("checked",!1),b.elem.parent().prev().children(".text").text(b.text).parent().children().filter(".text-limit").text(b.address),s.init.call(b.elem.parent().prev())},_able:function(a){a.unMsg.length?a.unTitle.html(a.unMsg.html()).show():a.unTitle.hide()},_load:function(b){a.Set("WAP[address_id]",b,720,"","/"),self.location.href=self.location},_noty:function(){a.redDialog("收货地址不能为空！")}},addAddress:function(){var b=cartDataList();b.length>=5?a.showDialog("抱歉，地址最多为5个哦<br />可修改或删除原来地址重新添加！",{overClose:!1,closeBtn:!0,setClass:"ui-modal-black",buttons:!1,overShow:!1,autoClose:2e3}):self.location.href="index.php?m=user&act=address&step=edit&filter=add&mk=1"},wallets:{init:function(){var b=$(this),c=cartDataList();dom={elem:b,checkBox:b.children().filter(".i-unselected"),isBind:parseInt(b.children('input[name="wallet"]').data("isbind")),isEnough:parseInt(b.children('input[name="wallet"]').data("enpay")),money:c.wallet,totleMoney:c.total,wallet:b.children('input[name="wallet"]'),walletPsw:b.children('input[name="wallet"]').next('input[name="wallet_password"]'),showMsg:b.children().children().filter('[data-wallet="paymsg"]'),neighbor:b.siblings("li").children().filter('input[name="pay_type"]')},isNaN(dom.isBind)||(1==dom.isBind?dom.money?void 0==dom.wallet.attr("checked")&&!dom.walletPsw.val()||"undefined"==dom.wallet.attr("checked")&&!dom.walletPsw.val()?t.wallets.elected(dom):t.wallets.cancle(dom):a.redDialog("您的钱包金额为0元，无法使用钱包支付！"):0==dom.isBind&&t.wallets.jump())},cancle:function(a){a.walletPsw.val("").prev().filter('input[name="wallet"]').val(""),a.checkBox.removeClass("active").parent().children('input[name="wallet"]').attr("checked",!1),a.isEnough&&a.neighbor.each(function(){$(this).attr("checked",!1).parent().children(".i-radio").removeClass("active"),$(this).parent().is(":hidden")?$(this).parent().slideDown():$(this).parent().hasClass("bankpay")&&$(this).attr("data-bankid","").attr("data-type","").parent().children(".i-radio").removeClass("active").parent().children("p").html("银行卡(<em>请选择支付卡种</em>)").next().children().find("li.nav-group-list").removeClass("active")}),a.showMsg.length&&a.showMsg.hide()},elected:function(a){a.isEnough?(a.checkBox.addClass("active").parent().children('input[name="wallet"]').attr("checked",!0),a.neighbor.each(!isNaN(a.totleMoney-a.money)&&a.totleMoney-a.money>0&&a.totleMoney-a.money<11?function(){50==$(this).val()?$(this).attr("checked",!0).parent().children(".i-radio").removeClass("active"):8==$(this).val()?($(this).parent().slideUp(),$(this).attr("checked",!1).parent().children(".i-radio").removeClass("active")):$(this).parent().hasClass("bankpay")?$(this).is("[checked]")&&$(this).attr("checked",!1).attr("data-bankid","").attr("data-type","").parent().children(".i-radio").removeClass("active").parent().children("p").html("银行卡(<em>请选择支付卡种</em>)").next().children().find("li.nav-group-list").removeClass("active"):$(this).attr("checked",!1).parent().children(".i-radio").removeClass("active")}:function(){50==$(this).val()?$(this).attr("checked",!0).parent().children(".i-radio").removeClass("active"):8==$(this).val()?($(this).parent().slideDown(),$(this).attr("checked",!1).parent().children(".i-radio").removeClass("active")):$(this).parent().hasClass("bankpay")?$(this).is("[checked]")&&$(this).attr("checked",!1).attr("data-bankid","").attr("data-type","").parent().children(".i-radio").removeClass("active").parent().children("p").html("银行卡(<em>请选择支付卡种</em>)").next().children().find("li.nav-group-list").removeClass("active"):$(this).attr("checked",!1).parent().children(".i-radio").removeClass("active")})):a.checkBox.addClass("active").parent().children('input[name="wallet"]').attr("checked",!0),a.showMsg.length&&a.showMsg.show()},jump:function(){location.href="user-wallet-bind-send.html"}},pay:{other:function(){var a=$(this),b=a.siblings("li.bankpay"),c={elem:a,radio:a.children().filter(".i-radio"),input:a.children().filter('input[type="radio"]'),neighbor:a.siblings("li"),neighborBank:b,next:b.children(".slide-down"),toggle:b.data("toggle"),collapse:b.data("collapse"),child:b.children().filter('[class^="i-icon-arrow"]')};!c.radio.hasClass("active")&&!(1==c.input.attr("checked"))&&(c.radio.addClass("active").parent().children().filter('input[type="radio"]').attr("checked",!0),c.neighbor.children().filter(".i-radio").removeClass("active").parent().children().filter('input[type="radio"]').attr("checked",!1),""!=c.neighborBank.children('input[type="radio"]').attr("data-bankid")&&c.neighborBank.children('input[type="radio"]').attr("data-bankid","").attr("data-type","").parent().children(".i-radio").removeClass("active").parent().children("p").html("银行卡(<em>请选择支付卡种</em>)").next().children().find("li.nav-group-list").removeClass("active"),c.collapse&&s.slide.up.call(c))},bank:{_slide:function(){var a=$(this).parent(),b={elem:a,next:a.children(".slide-down"),toggle:a.data("toggle"),collapse:a.data("collapse"),child:a.children().filter('[class^="i-icon-arrow"]'),remove:!0,scrol:!0};b.collapse&&b.next.length&&r.detect.call(b.next)?(b.child.addClass(b.toggle),b.next.slideDown(),b.scrol&&s.slide.scrol.call(b.elem)):(b.remove&&b.child.removeClass(b.toggle),b.next.slideUp())},_type:function(){var a=$(this),b={elem:a,index:a.parent().children().index(this),next:a.parent().next().children().children("ul")};!b.elem.hasClass("active")&&s.tab.call(b)},_list:function(){var a=$(this),b=a.parents("li").children('input[name="pay_type"]'),c={elem:a,next:a.parents(".slide-down"),toggle:a.parents("li").data("toggle"),collapse:a.parents("li").data("collapse"),radio:a.parents("li").children(".i-radio"),radioNeighbor:a.parents("li").siblings().children(".i-radio"),id:a.children("span").data("bankid"),type:parseInt(a.children("span").attr("data-type")),pay_type:parseInt(b.val()),pay_bank:parseInt(b.val()),pay:a.parent().parent().data("twipay"),payid:a.children("span").attr("data-type"),bankid:a.children("span").attr("data-bankid"),orders:b.attr("data-orders"),ispos:b.attr("data-ispos"),cashier:b.attr("data-cashier"),text:a.parents("li").children("p"),scrol:!1,remove:!1};c.pay_type<0?c.pay_type=-1*c.pay_type:c.pay_type,c.elem.hasClass("active")?"":(c.elem.addClass("active").siblings().removeClass("active").parent().siblings().children().filter("li").removeClass("active"),c.radio.addClass("active").parent().children('input[type="radio"]').attr("data-bankid",c.id).attr("data-type",c.type).attr("checked",!0),c.radioNeighbor.hasClass("active")&&c.radioNeighbor.removeClass("active").parent().children('input[type="radio"]').attr("checked",!1),c.text.html(c.elem.text()),"boolean"==typeof c.pay&&c.pay&&D.triggerTwicePayDo(c),c.collapse&&s.slide.toggle.call(c))}}},invoice:function(){var a=$(this),b={elem:a,neighbor:a.parent().siblings().children(".title"),next:a.parent().siblings(),invoice_name:a.parent().parent().find('input[name="invoice"]').val(),check_icon:a.parent().parent().find("span.u-icon"),invoice_inputbox:a.parent().parent().find("#invoice_inputbox")};""!=b.invoice_name?b.check_icon.removeClass("i-unselected").addClass("i-selected"):"none"!=b.invoice_inputbox.css("display")?b.check_icon.removeClass("i-selected").addClass("i-unselected"):b.check_icon.removeClass("i-unselected").addClass("i-selected"),r.detect.call(b.next)&&b.elem.parent().slideUp().siblings().slideDown()}},u={init:function(){var b=$(this).parents('[data-formorder="checkoutForm"]'),c={elem:$(this),addressId:b.find('input[name="address_id"]'),address_id:b.find('input[name="address_id"][checked]').val(),areaId:b.find("input[name='area_id']"),area_id:b.find("input[name='area_id'][checked]").val(),areaName:b.find("input[name='area_name']"),area_name:b.find("input[name='area_name'][checked]").val(),wallet:b.find("input[name='wallet']").length?b.find("input[name='wallet']"):null,walletPsw:b.find("input[name='wallet_password']"),wallet_password:b.find("input[name='wallet_password']").val(),payType:b.find("input[name='pay_type']"),pay_type:parseInt(b.find("input[name='pay_type'][checked]").val()),pay_bank:b.find("input[name='pay_type'][checked]"),transport:b.find("input[name='transport_day']"),transport_day:b.find("input[name='transport_day'][checked]").val(),favourable_id:b.find("input[name='favourable_id']").val(),invoice:b.find("input[name='invoice']").val(),receiver:b.find('input[name^="inputReceiver"]').length?b.find('input[name^="inputReceiver"]'):!1,idCard:b.find('input[name^="inputIdCard"]').length?b.find('input[name^="inputIdCard"]'):!1};if(window.localStorage){var d=localStorage.getItem("pay_fail");if(d&&null!=d&&void 0!=d){if(d=$.evalJSON(d),d.showLayout&&d.orders){var e=new Array(d.orders,d.is_supplier,d.address_id,d.paytype_id,d.bank_id,d.is_cashier);e=rstr2b64(e.join(":")),a.showDialog("您的支付是否遇到问题？请继续支付...",{title:'<i class="i-icon-tips"></i>您的订单已经提交',setClass:"ui-modal-btn-tips",closeBtn:!1,overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"取消",attribute:!1},{name:"确定",attribute:!0}],buttonsPos:2,buttonsStyle:"btn-purple",onDoComplete:function(a,b){b.oncomplete(!1),localStorage.removeItem("pay_fail")},onDoCompleteTo:function(a,b){b.oncomplete(!1),location.href=""!=d.isTempUser&&1==d.isTempUser?"cart-payresult.html?oi="+e+"&from=cart":"cart-payresult.html?oi="+e}})}return!1}return u.verifyIdCard(c),!1}return u.verifyIdCard(c),!1},verifyIdCard:function(b){if((b.receiver||b.receiver)&&(b.idCard||b.idCard)){var c=a.validate.empty(b.receiver.val()),d=a.validate.empty(b.idCard.val());if(!c)return o.noty(l,"收货人姓名不能为空！",39),!1;if(o.hasSpace(b.receiver.val()))return o.noty(l,"收货人姓名不能含有空格！",39),!1;if(o.textValid(b.receiver.val()))return o.noty(l,"收货人姓名不能含有特殊符号！",39),!1;if(!a.validate.dataType.c.test($.trim(b.receiver.val())))return o.noty(l,"请填写1~8位中文姓名",39),!1;if(!d)return o.noty(m,"身份证号码不能为空！",100),!1;if(!o.idCardValidate(b.idCard))return!1}b.receiver&&b.idCard?(b.elem.children(".cart-time").hide(),$("<div />",{"class":"navbar-mask"}).html('<img src="view/touch/images/common/loading-big.gif" style="width:20px;"/>').appendTo(b.elem.parent()),a.showDialog('<h3><img src="view/touch/images/common/loading-big.gif" alt="loading" /></h3><p class="fontred">正在验证</p>',{setClass:"ui-white-loading",overClose:!1,closeBtn:!1,width:80,autoCall:!0,onAutoComplete:function(c){var d={url:"ajaxapi-getconsignessidcard.html?&s="+(new Date).getTime(),data:{consignee:b.receiver.val()},dataType:"json",type:"POST"};d.error=function(){c.callback(),b.elem.children(".cart-time").show().parent().next().remove(),a.blackDialog("网络加载异常，请刷新页面重试!")},d.success=function(d){if(d&&null!=d&&void 0!=d)if(1==d.code&&1==d.status)c.callback(),u.verifyForm(b),b.elem.children(".cart-time").show().parent().next().remove();else if(d.code||d.status)c.callback(),b.elem.children(".cart-time").show().parent().next().remove(),a.blackDialog(d.msg);else{var e={url:"ajaxapi-verifyidcard.html?&s="+(new Date).getTime(),data:{consignee:b.receiver.val(),id_number:rstr2b64(b.idCard.val())},dataType:"json",type:"POST"};e.error=function(){c.callback(),b.elem.children(".cart-time").show().parent().next().remove(),a.blackDialog("网络加载异常，请刷新页面重试!")},e.success=function(d){c.callback(),d&&null!=d&&void 0!=d?1==d.code&&1==d.status?(u.verifyForm(b),b.elem.children(".cart-time").show().parent().next().remove()):d.code||d.status?(a.blackDialog(d.msg),b.elem.children(".cart-time").show().parent().next().remove()):(a.flicker(m,"ui-note-error",!1,1,5,100),a.showDialog(d.msg.length?d.msg:" ",{title:'<i class="i-icon-tips"></i>唯品会提醒你',setClass:"ui-modal-btn-tips",overClose:!1,buttons:!0,closeBtn:!1,type:"defined",buttonsCus:[{name:"我知道了",attribute:!1}],buttonsPos:1,buttonsStyle:"btn-purple",onDoComplete:function(a,c){c.oncomplete(!1),b.elem.children(".cart-time").show().parent().next().remove()}})):(a.blackDialog("网络加载异常，请刷新页面重试!"),b.elem.children(".cart-time").show().parent().next().remove())},$.ajax(e)}else c.callback(),b.elem.children(".cart-time").show().parent().next().remove(),a.blackDialog("网络加载异常，请刷新页面重试!")},$.ajax(d)}})):u.verifyForm(b)},verifyForm:function(b){return b.pay_type<0?b.pay_type=-1*b.pay_type:b.pay_type,b.addressId.length&&b.areaId.length&&b.areaName.length&&(b.addressId.is("[checked]")||b.areaId.is("[checked]")||b.areaName.is("[checked]"))&&b.addressId.is("[checked]")&&b.areaId.is("[checked]")&&b.areaName.is("[checked]")&&""!=b.address_id&&""!=b.area_id&&""!=b.area_name?!b.transport.is("[checked]")&&void 0==typeof b.transport_day||!b.transport.is("[checked]")&&"undefined"==typeof b.transport_day?(s.noty.address($('[data-cartforms="time"]'),"请选择收货时间"),!1):null!=b.wallet&&b.wallet.is("[checked]")&&b.wallet_password.length<1&&""==b.wallet_password?(a.showDialog('<div class="ui-group"><div class="ui-c-group"><input name="wPsw" type="password" class="binput" placeholder="请输入密码" style="font-size:16px;color:#999" /></div><div class="ui-c-group" style="display:none;"></div></div>',{title:'请输入钱包支付密码<a href="user-wallet-reset-index.html" class="fr colorblue">忘记密码？</a>',setClass:"ui-modal-btn-tips form-modal",isCenter:!1,closeBtn:!1,overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"取消",attribute:!1},{name:"确定",attribute:!0}],buttonsPos:2,buttonsStyle:"btn-purple",onDoComplete:function(a,b){b.oncomplete(!1)},onDoCompleteTo:function(c,d){var e={elem:c,psw1:c.parent().prev().children().find('input[name="wPsw"]'),txt:"密码"},f=a.validate.empty(e.psw1.val())?e.psw1.val():"";return""==f?(e.psw1.parent().next().addClass("error").html(e.txt+"不能为空").show(),e.psw1.focus(),!1):f.length<6||f.length>20?(e.psw1.parent().next().addClass("error").html("请输入6-20位字母和数字的组合！").show(),e.psw1.focus(),!1):isNaN(f)&&"-1"==f.search(a.validate.dataType.s)?(b.walletPsw.val(rstr2b64(e.psw1.val())).prev().filter('input[name="wallet"]').val(1),u.subForm(b),d.oncomplete(!1),void 0):(e.psw1.parent().next().addClass("error").html(e.txt+"格式错误，请使用字母和数字组合").show(),e.psw1.focus(),!1)}}),!1):(u.subForm(b),!1):(s.noty.address($('[data-cartforms="address"]'),"请选择收货地址"),!1)},subForm:function(b){return b.payType.length>0?!b.payType.is("[checked]")&&isNaN(b.pay_type)?(s.noty.addressTip($('[data-cartforms="payway"]'),"请选择支付方式",n),!1):b.pay_type<1?(s.noty.addressTip($('[data-cartforms="payway"]'),"请选择支付方式",n),!1):void(b.transport.is("[checked]")&&b.transport_day&&b.payType.is("[checked]")&&!isNaN(b.pay_type)&&a.showDialog("订单正在提交中",{title:void 0,overClose:!1,setClass:"ui-modal-black",buttons:!1,overShow:!0,autoCall:!0,closeBtn:!1,onAutoComplete:function(c){if(b.elem.children(".cart-time").hide(),$("<div />",{"class":"navbar-mask"}).html('<img src="view/touch/images/common/loading-big.gif" style="width:20px;"/>').appendTo(b.elem.parent()),b.pay_bank.val()<0&&2===b.pay_type)var d={url:"index.php?m=flow&act=done",data:{address_id:b.address_id,area_id:b.area_id,area_name:b.area_name,transport_day:b.transport_day,paytype_id:b.pay_bank.attr("data-type"),bank_id:b.pay_bank.attr("data-bankid"),is_cashier:b.pay_bank.attr("data-cashier"),favourable_id:b.favourable_id,invoice:b.invoice,wallet:null!=b.wallet?b.wallet.val():"",wallet_password:null!=b.wallet?b.walletPsw.val():""},dataType:"json",type:"POST"};else var d={url:"index.php?m=flow&act=done",data:{address_id:b.address_id,area_id:b.area_id,area_name:b.area_name,transport_day:b.transport_day,paytype_id:b.pay_type,favourable_id:b.favourable_id,invoice:b.invoice,wallet:null!=b.wallet?b.wallet.val():"",wallet_password:null!=b.wallet?b.walletPsw.val():""},dataType:"json",type:"POST"};d.error=function(){c.callback(),b.elem.children(".cart-time").show().parent().next().remove(),a.redDialog("网络延时，提交订单失败！")},d.success=function(d){if(c.callback(),b.elem.children(".cart-time").show().parent().next().remove(),d&&null!=d&&void 0!=d)if(100==d.code){if(window.localStorage&&localStorage.removeItem("paytype"),d.url&&setTimeout(function(){self.location.href=d.url},500),d.orders&&8!==b.pay_type&&window.localStorage){var e=new Object;e=d,e.showLayout=1,localStorage.setItem("pay_fail",$.toJSON(e)),u.setWhiteBg(e)}}else{if(101==d.code&&d.msg)return a.showDialog("您的订单已经提交，购物车为空，请刷新页面！ ^_^",{title:'<i class="i-icon-tips"></i>您的订单已经提交',setClass:"ui-modal-btn-tips",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"取消",attribute:!1},{name:"确定",attribute:!0}],buttonsPos:2,buttonsStyle:"btn-purple",onDoComplete:function(a,b){b.oncomplete(!1)},onDoCompleteTo:function(a,b){b.oncomplete(!1),self.location.href=location.href}}),!1;if(d.code>101&&d.msg)return 106==d.code?(b.walletPsw.val(""),a.redDialog(d.msg),!1):112==d.code?(a.showDialog(d.msg.length?d.msg:" ",{title:'<i class="i-icon-tips"></i>唯品会提醒你',setClass:"ui-modal-btn-tips",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"我知道了",attribute:!1}],buttonsPos:1,buttonsStyle:"btn-purple",onDoComplete:function(a,b){b.oncomplete(!1)}}),!1):(a.redDialog(d.msg),!1)}else a.redDialog("网络延时，提交订单失败！")},$.ajax(d)}})):(s.noty.addressTip($('[data-cartforms="payway"]'),"请选择支付方式",n),!1)},checkPayFail:function(){if(window.localStorage){var a=localStorage.getItem("pay_fail");a&&null!=a&&void 0!=a&&(a=$.evalJSON(a),a.showLayout&&a.orders&&u.setWhiteBg(a))}},setWhiteBg:function(a){var b="",c=new Array(a.orders,a.is_supplier,a.address_id,a.paytype_id,a.bank_id,a.is_cashier);c=rstr2b64(c.join(":")),b=""!=a.isTempUser&&1==a.isTempUser?"cart-payresult.html?oi="+c+"&from=cart":"cart-payresult.html?oi="+c,$(".subSuccessBg").length||$("body").append('<div class="bg_white subSuccessBg"></div>'),$(".subSuccessBg").off("click.checkout.subSuccessBg").on("click.checkout.subSuccessBg",function(){window.location.href=b})},hidePayTypeTip:function(){(f.find(".i-radio.active").length||f.find(".nav-group-list.active").length)&&n.hide()}},v={init:function(){}},w={categorySet:function(){var a={wH:$(window).innerHeight()};0==window.orientation||180==window.orientation?w.categoryStyle(a,.5):90==window.orientation||-90==window.orientation?w.categoryStyle(a,.3):w.categoryStyle(a,.5)},categoryStyle:function(a,b){return $("#drop-bankWrap").css({height:a.wH*b+"px"}),!1}},x={init:function(){var b=cartDataList();if(b.cross)this.checkordersStatus(b.cross,b.area,"warehouse",function(c){return a.showDialog(c.message,{setClass:"ui-modal-black2",closeBtn:!1,overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:c["btn-false"],attribute:!1},{name:c["btn-true"],attribute:!0}],buttonsPos:2,buttonsStyle:"btn-purple",onDoComplete:function(c,d){var e={url:"index.php?",data:{m:"ajax",act:"change_warehouse",wh:b.warehouse},dataType:"json",type:"POST"},f=VIP.localStorage.getItem("changing_warehouse_type")||"";e.error=function(){d.oncomplete(!1),a.redDialog("网络延时，提交订单失败！")},e.success=function(a){Mar.Seed.request("button","click","cart-exchange_btn","type:"+f),setTimeout(function(){location.href=a&&null!=a&&void 0!=a&&1==a.code&&a.url?a.url:"index.html"},200)},$.ajax(e)},onDoCompleteTo:function(){var a=VIP.localStorage.getItem("changing_warehouse_type")||"";Mar.Seed.request("button","click","cart_re-edit_btn","type:"+a),setTimeout(function(){self.location.href="cart-address.html?mk=1"},200)}}),!1});else if(b.isDelivery)return this.checkordersStatus(b.isDelivery,b.isNotDeliveryGoods,"delivery",function(b){a.showDialog(b.message,{title:b.title,setClass:"ui-modal-btn-tips",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:b["btn-false"],attribute:!1},{name:b["btn-true"],attribute:!0}],buttonsPos:2,buttonsStyle:"btn-purple",onDoComplete:function(a,b){b.oncomplete(!1),self.location.href="cart-address.html?mk=1"},onDoCompleteTo:function(a,b){b.oncomplete(!1),self.location.href="cart.html"}})}),!1},checkordersStatus:function(a,b,c,d){function e(){var a=b.split(",");return a}var f={warehouse:{title:"",message:"<p>该订单只支持发货至"+b+"，切换站点重新购买，购物车将会被清空。</p>","btn-false":"切换站点","btn-true":"修改地址"},delivery:{title:'<i class="i-icon-tips"></i>以下商品不支持送达该地址',message:"","btn-false":"修改地址","btn-true":"返回购物车"}};switch(showDialog={warehouse:a,delivery:a},c){case"warehouse":showDialog[c]&&d(f[c]);break;case"delivery":f[c].message+='<ul class="data-list">';for(var g=0;g<e().length;g++)f[c].message+="<li><span>●</span>"+e()[g]+"</li>";f[c].message+="</ul>",f[c].message+='<p style="text-align:center">你可以返回购物车，删除商品后继续结算</p>',showDialog[c]&&d(f[c])}}},y={events:function(){b.off("click.orderform.set").on("click.orderform.set",u.init),c.off("click.repeatform.set").on("click.repeatform.set",v.init),e.children(".title").off("click.toggle.time").on("click.toggle.time",s.init),e.children(".nav").children().filter("li").off("click.choose.time").on("click.choose.time",t.info.init),f.children(".nav").children().filter("li.otherpay").off("click.choose.pay").on("click.choose.pay",t.pay.other),f.children(".nav").children("li.bankpay").children("p").off("click.choose.bankpay").on("click.choose.bankpay",t.pay.bank._slide),f.children(".nav").children("li.walletpay").off("click.choose.wallet").on("click.choose.wallet",t.wallets.init),g.children().filter("li").off("click.choose.banktype").on("click.choose.banktype",t.pay.bank._type),h.find("li").off("click.choose.banklist").on("click.choose.banklist",t.pay.bank._list),i.children().children().children(".title").off("click.invoice.set").on("click.invoice.set",t.invoice),j.off("click.address.add").on("click.address.add",t.addAddress),k.find(".i-delete-text").off("click.remove.text").on("click.remove.text",p.removeTxt),f.find(".i-radio").parent().off("click.payTypeTip").on("click.payTypeTip",u.hidePayTypeTip),f.find(".nav-group-list").off("click.payTypeTip").on("click.payTypeTip",u.hidePayTypeTip)}},z={init:function(){y.events(),q.runTime(),x.init(),w.categorySet(),u.checkPayFail()}};return{init:z.init}}(hawk);$(function(){pageCheckoutEffect.init()});