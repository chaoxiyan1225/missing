var pageBouns=function(a){var b=$('[data-tabsel="tab"]'),c=$(".panel-content"),d=$("[data-favorable]"),e='<span class="ui-clockout">							<span class="ui-clockin">							  <span class="ui-swing1"></span>							  <span class="ui-swing2"></span>							  <span class="ui-clockcirle"></span>							</span>						  </span>',f={localHref:function(a){var b=document.createElement("a");return b.href=a,{num:parseInt(/[0-4]{1}/g.exec(b.pathname),10),source:a,file:(b.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],query:b.search,params:function(){for(var a,c={},d=b.search.replace(/^\?/,"").split("&"),e=d.length,f=0;e>f;f++)d[f]&&(a=d[f].split("="),c[a[0]]=a[1]);return c}()}}},g={add:function(){_.templateSettings={variable:"data",evaluate:/#%([\s\S]+?)%#/g,interpolate:/#%=([\s\S]+?)%#/g,escape:/#%-([\s\S]+?)%#/g};var b=$(this),c={elem:b,favourable_code:b.parent().find('input[name="favourable_code"]'),msg:b.data("text"),type:b.data("bonustype"),bonusListTpl:_.template($("#bonus-list-tpl").html()),direction:"center"};if(!a.validate.empty(c.favourable_code.val()))return a.blackDialog(c.msg),c.favourable_code.focus(),!1;var d={url:"ajaxapi-addcoupon.html?",data:{act:c.type,favourable_code:c.favourable_code.val()},dataType:"json",type:"POST"};d.error=function(){a.blackDialog("网络加载异常，请刷新页面重试!")},d.success=function(b){b&&null!=b&&void 0!=b&&(b.status&&1==b.code?a.showDialog(b.msg,{title:'<i class="i-icon-tips"></i>唯品会提醒您',setClass:"ui-modal-btn-tips",overClose:!1,buttons:!0,closeBtn:!1,type:"defined",onCloseCallBack:!0,buttonsCus:[{name:"确定",attribute:!1}],buttonsPos:1,buttonsStyle:"btn-purple",onDoComplete:function(b,d){d.oncomplete(!1),a.showDialog('<h3><img src="view-src/touch/images/common/loading-big.gif" alt="loading" /></h3><p class="fontred">正在加载</p>',{setClass:"ui-white-loading",overClose:!1,closeBtn:!1,width:80,autoCall:!0,onAutoComplete:function(a){g.listBonus(c,a)}})}}):a.blackDialog(b.status||b.code?b.msg:b.msg))},$.ajax(d)},listBonus:function(c){var d,e={url:"ajaxapi-getcouponlist.html?",data:{},dataType:"json",type:"GET"},f=arguments[1]?arguments[1]:!1;!f&&(d=c.next.filter('[data-type="'+c.type+'"]'),d.prepend('<div class="u-loading"><img src="view-src/touch/images/common/loading-big.gif" alt="loading" />加载中</div>')),e.error=function(){f&&f.callback(),!f&&d.children(".u-loading").remove(),a.blackDialog("网络加载异常，请刷新页面重试!")},e.success=function(e){if(f&&f.callback(),!f&&d.children(".u-loading").remove(),e&&null!=e&&void 0!=e)if(e.status&&1==e.code){var g;switch(g="coupon"===c.type?{dataList:e.data.available_list?e.data.available_list:null,type:c.type,text:"优惠券"}:{dataList:e.data.giftcard?e.data.giftcard:null,type:c.type,text:"礼品卡"},c.direction){case"center":c.elem.parent().prev().remove(),c.elem.parent().parent().prepend(c.bonusListTpl(g)),b.children("li").attr("data-barrier",!0);break;case"top":c.elem.attr("data-barrier",!1),d.children().filter(".panel-group").remove(),d.prepend(c.bonusListTpl(g));break;default:return!1}}else e.status||e.code?a.blackDialog(e.msg):(e.msg.length>0&&a.blackDialog(e.msg),c.elem.attr("data-barrier",!1))},$.ajax(e)},useBonus:function(){var b=$(this),c={bonusId:b.data("bonus_id"),type:b.data("bonus_type"),showTxt:"您已经使用了",child:b.children(".i-icon-check-ok")};return!a.validate.empty(c.bonusId)||isNaN(c.bonusId)?(a.blackDialog("无法使用，未知错误！"),!1):(c.child.addClass("active"),void a.showDialog(e,{width:100,height:60,setClass:"ui-modal-loading",overClose:!1,closeBtn:!1,autoCall:!0,onAutoComplete:function(b){var d={url:"index.php?",data:{m:"flow",act:"bonus",step:"use_bonus",bonus_id:c.bonusId},dataType:"json",type:"GET"};d.error=function(){b.callback(),c.child.removeClass("active"),a.blackDialog("网络加载异常，请刷新页面重试!")},d.success=function(d){if(b.callback(),d&&null!=d&&void 0!=d)switch(c.type){case 1:a.blackDialog(c.showTxt+"代金券");break;case 2:a.blackDialog(c.showTxt+"礼品卡");break;case 3:a.blackDialog(c.showTxt+"优惠券")}else c.child.removeClass("active"),a.blackDialog("网络加载异常，请刷新页面重试!")},$.ajax(d)}}))},coupon:{list:function(){var a=$(this),b={elem:a,input:a.children('input[name="coupon"]'),choose:a.children(".i-icon-check-ok"),neighbor:a.siblings('[data-action="selCoupon"]'),couponFieldId:a.data("coupon_fieldid"),useBtn:$('[data-role="button"]')};b.input.is(":radio")?g.coupon.entire(b):g.coupon.part(b)},entire:function(b){b.choose.hasClass("active")||b.input.is("[checked]")?(b.input.attr("checked",!1).parent().children(".i-icon-check-ok").removeClass("active"),b.useBtn.addClass("disabled").removeClass("btn-purple").removeAttr("data-action","useCoupon")):(b.neighbor.children().filter('input[type="checkbox"]').is("[checked]")?a.showDialog('<p style="text-align:center">选用全场券<br/>将会取消专场券的使用！<br/>确定选用全场券吗？</p>',{title:'<i class="i-icon-tips"></i>使用全场券',setClass:"ui-modal-btn-tips",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"取消",attribute:!1},{name:"确定",attribute:!0}],buttonsPos:2,buttonsStyle:"btn-purple",onDoComplete:function(a,b){b.oncomplete(!1)},onDoCompleteTo:function(a,c){c.oncomplete(!1),b.input.attr("checked",!0).parent().children(".i-icon-check-ok").addClass("active"),b.neighbor.children().filter('input[name="coupon"]').attr("checked",!1).parent().children(".i-icon-check-ok").removeClass("active")}}):(b.input.attr("checked",!0).parent().children(".i-icon-check-ok").addClass("active"),b.neighbor.children().filter('input[name="coupon"]').attr("checked",!1).parent().children(".i-icon-check-ok").removeClass("active")),b.useBtn.addClass("btn-purple").removeClass("disabled").attr("data-action","useCoupon"))},part:function(b){b.choose.hasClass("active")||b.input.is("[checked]")?(b.input.attr("checked",!1).parent().children(".i-icon-check-ok").removeClass("active"),b.useBtn.addClass("disabled").removeClass("btn-purple").removeAttr("data-action","useCoupon")):b.neighbor.children().filter('input[type="radio"]').is("[checked]")?a.showDialog('<p style="text-align:center">选用专场券<br/>将会取消全场券的使用！<br/>确定选用专场券吗？</p>',{title:'<i class="i-icon-tips"></i>使用专场券',setClass:"ui-modal-btn-tips",overClose:!1,buttons:!0,type:"defined",buttonsCus:[{name:"取消",attribute:!1},{name:"确定",attribute:!0}],buttonsPos:2,buttonsStyle:"btn-purple",onDoComplete:function(a,b){b.oncomplete(!1)},onDoCompleteTo:function(a,c){c.oncomplete(!1),b.input.attr("checked",!0).parent().children(".i-icon-check-ok").addClass("active"),b.neighbor.children().filter('input[type="radio"]').attr("checked",!1).parent().children(".i-icon-check-ok").removeClass("active"),b.neighbor.filter('[data-coupon_fieldid="'+b.couponFieldId+'"]').length&&b.neighbor.filter('[data-coupon_fieldid="'+b.couponFieldId+'"]').children('input[type^="checkbox"]').is("[checked]")&&b.neighbor.filter('[data-coupon_fieldid="'+b.couponFieldId+'"]').children('input[type^="checkbox"]').attr("checked",!1).parent().children(".i-icon-check-ok").removeClass("active")}}):(b.input.attr("checked",!0).parent().children(".i-icon-check-ok").addClass("active"),b.neighbor.children().filter('input[type="radio"]').attr("checked",!1).parent().children(".i-icon-check-ok").removeClass("active"),b.neighbor.filter('[data-coupon_fieldid="'+b.couponFieldId+'"]').length&&b.neighbor.filter('[data-coupon_fieldid="'+b.couponFieldId+'"]').children('input[type^="checkbox"]').is("[checked]")&&b.neighbor.filter('[data-coupon_fieldid="'+b.couponFieldId+'"]').children('input[type^="checkbox"]').attr("checked",!1).parent().children(".i-icon-check-ok").removeClass("active"),b.useBtn.addClass("btn-purple").removeClass("disabled").attr("data-action","useCoupon"))},use:function(){var b={coupons:new Array,elem:$('input[name="coupon"]'),text:"您已经使用了"};return $.each(b.elem,function(){$(this).is("[checked]")&&b.coupons.push($(this).val())}),b.coupons.length?void a.showDialog(e,{width:100,height:60,setClass:"ui-modal-loading",overClose:!1,closeBtn:!1,autoCall:!0,onAutoComplete:function(c){var d={url:"index.php?m=flow&act=bonus&step=use_coupon",data:{coupons:b.coupons.join(",")},dataType:"json",type:"POST"};d.error=function(){c.callback(),a.blackDialog("网络加载异常，请刷新页面重试!")},d.success=function(d){if(c.callback(),d&&null!=d&&void 0!=d){if(1==d.code)a.showDialog(b.text+"优惠券, 正在跳回购物车页面",{setClass:"ui-success",overShow:!1,overClose:!1,position:[{top:0},{left:0}],width:"100%",autoClose:3e3}),setTimeout(function(){self.location.href="cart.html"},2e3);else if(-1==d.code)return a.blackDialog("购物车中的商品不满足使用优惠券条件"),!1}else a.blackDialog("网络加载异常，请刷新页面重试!")},$.ajax(d)}}):void a.blackDialog("请选择优惠券")}},tab:{init:function(){var a=location.href,d=f.localHref(a),e={pars:b,next:c,type:d.params.tabType?d.params.tabType:null};e.pars.children("li").attr("data-barrier",!0),e.type&&isNaN(e.type)&&null!=e.type?g.tab.autoSelectTab.call(e):g.tab.autoSelect.call(e)},selected:function(){_.templateSettings={variable:"data",evaluate:/#%([\s\S]+?)%#/g,interpolate:/#%=([\s\S]+?)%#/g,escape:/#%-([\s\S]+?)%#/g};var a=$(this),d={elem:a,child:a.children(),pars:b,next:c,bonusListTpl:_.template($("#bonus-list-tpl").html()),type:a.data("type"),direction:"top"};g.tab.autoSelectTab.call(d)},autoSelect:function(){this.pars.children("li").length&&(this.node=this.pars.children("li").filter(":eq(0)"),this.pars.children("li").filter(":eq(0)").children("a").addClass("nav_current").parent().siblings().children("a").removeClass("nav_current"),this.next.filter(":eq(0)").show().siblings().filter(".panel-content").hide())},autoSelectTab:function(){var a=this.type;this.pars.children("li").filter('[data-type="'+a+'"]').children("a").addClass("nav_current").parent().siblings().children("a").removeClass("nav_current"),this.next.filter(".panel-content:visible").fadeOut(100,function(){$('[data-type="'+a+'"]').fadeIn(100)}),this.elem&&"history"!=a?"false"===this.elem.attr("data-barrier")?null:g.listBonus(this):this.pars.children("li").filter('[data-type="'+a+'"]').attr("data-barrier",!1)}},focus:function(){var a=$(this),b={elem:a,clsName:a.attr("data-classname"),nextBtn:a.parent().children('input[type="button"]')};b.elem.val()&&""!=b.elem.val()&&b.elem.val().length&&b.elem.val(""),b.nextBtn.addClass(""+b.clsName).attr("disabled",!1)},blur:function(){var a=$(this),b={elem:a,clsName:a.attr("data-classname"),nextBtn:a.parent().children('input[type="button"]')};b.elem.val()&&""!=b.elem.val()&&b.elem.val().length?b.nextBtn.addClass(""+b.clsName).attr("disabled",!1):b.nextBtn.removeClass(""+b.clsName).attr("disabled",!0)}},h={events:function(){b.children("li").off("click.select.tab").on("click.select.tab",g.tab.selected),d.off("click.action.addbonus",'[data-action="addBonus"]').on("click.action.addbonus",'[data-action="addBonus"]',g.add),c.off("click.action.usebonus",'[data-action="useBonus"]').on("click.action.usebonus",'[data-action="useBonus"]',g.useBonus),c.off("click.action.selcoupon",'[data-action="selCoupon"]').on("click.action.selcoupon",'[data-action="selCoupon"]',g.coupon.list),c.off("click.action.usecoupon",'[data-action="useCoupon"]').on("click.action.usecoupon",'[data-action="useCoupon"]',g.coupon.use),d.find('input[name="favourable_code"]').on("focus",g.focus).on("blur",g.blur)}},i={censor:function(){b.length&&g.tab.init()}},j={init:function(){h.events(),i.censor(),VIP.util.navFix($("#nav"))}};return{init:j.init}}(hawk);$(function(){pageBouns.init()});